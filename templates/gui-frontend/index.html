<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>alfa_fw_updater</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <script type="text/javascript" src="/eel.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-selection@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>    
    
    <script type="text/javascript">
      var settings;
      var current_box;
      async function html_init() {
        eel.say_hello_py("Javascript World!");       
        //set_current_box("welcome");
        load_settings();
      }
    
      async function load_settings() {
        settings = await eel.get_settings()();
        document.getElementById('setting-serial-port').value = settings.serial_port;
        document.getElementById('setting-strategy').value = settings.strategy;         
        
        if ("_default" in settings && settings["_default"])
          open_settings_box();
      }

      function save_settings() {
        settings.serial_port = document.getElementById('setting-serial-port').value;
        settings.strategy = document.getElementById('setting-strategy').value;
        eel.save_settings(settings);         
      }
      
      function open_settings_box() {
        document.getElementById('settings-box').classList.add('is-active');
      }
      
      function close_settings_box() {
        document.getElementById('settings-box').classList.remove('is-active');      
      }
            
    </script>
  </head>
  <body onload="html_init()">
    <nav class="navbar" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://bulma.io">
          <img src="https://bulma.io/images/bulma-logo.png" width="112" height="28">
        </a>

      </div>

      <div id="navbarBasicExample" class="navbar-menu">
        <div class="navbar-start">       
          <div class="navbar-item">
            <div class="buttons">
              <a class="button">
                <strong>Welcome</strong>
              </a>
              <a class="button">
                <strong>Settings</strong>
              </a>
              <a class="button">
                <strong>Manual update</strong>
              </a>
              <a class="button">
                <strong>Machine update</strong>
              </a>
            </div>
          </div>
        </div>

        <div class="navbar-end">
          <div class="navbar-item">
            <div class="buttons">
              <a class="button is-primary">
                <strong>Settings</strong>
              </a>
            </div>
          </div>
          
          <div class="navbar-item">
            Current status: STATUS
          </div>
          
        </div>
      </div>
    </nav>  

    <div class="box" id="box-welcome">
      <div class="box">
        <p class="title">Welcome to alfa_fw_upgrader!</p>
        <p>This tool will guide you to upgrade one or more of our boards, or all of them.</p>
      </div>
      <div class="tile is-ancestor">
        <div class="tile is-parent is-vertical">
          <article class="tile is-child notification is-dark-grey">
            <p class="title">adjust settings</p>
            <p class="subtitle">set the parameters to connect to main board.</p>
            <p class="buttons"><a class="button">Go to settings</a></p>
          </article>
        </div>
        <div class="tile is-parent">
          <article class="tile is-child notification  is-dark-grey">
            <p class="title">single mode</p>
            <p class="subtitle">in this mode you can program a single board.</p>
            <p class="buttons"><a class="button">Go to page</a></p>
          </article>
        </div>
        <div class="tile is-parent">
          <article class="tile is-child notification   is-dark-grey">
            <div class="content">
              <p class="title">machine update</p>
              <p class="subtitle">in this mode you can update from a package.</p>
              <p class="buttons"><a class="button">Go to page</a></p>              
            </div>
          </article>
        </div>
      </div>      
    </div>

    <div class="box" id="box-settings">
    
    </div>

    <div class="modal" id="settings-box">
      <div class="modal-background"></div>
      <div class="modal-card">
        <header class="modal-card-head">
          <p class="modal-card-title">Settings</p>
          <button class="delete" aria-label="close"></button>
        </header>
        <section class="modal-card-body">
          <div class="field">
            <label class="label">Serial port (e.g. /dev/ttyUSB0 on Linux, COM1 on Windows)</label>
            <div class="control">
              <input id="setting-serial-port" class="input" type="text" placeholder="Serial port">
            </div>
          </div>
          <div class="field">
            <label class="label">Connection Modality</label>
            <div class="control">
              <div class="select">
                <select id="setting-strategy">
                  <option value="simple">Simple (legacy mode)</option>
                  <option value="polling">Polling (first start connecting, then power on the board)</option>
                  <option value="serial">Serial (go to update mode when application is running)</option>
                </select>
              </div>
            </div>
          </div>
        </section>
        <footer class="modal-card-foot">
          <button class="button is-success" onclick="save_settings();">Save changes</button>
          <button class="button">Cancel</button>
        </footer>
      </div>
    </div>
  </body>
</html>
